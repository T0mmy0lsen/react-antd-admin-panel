# Story 6.3: Testing Utilities & Mocks

## Status
Ready for Review

## Story

**As a** developer testing applications built with react-antd-admin-panel,
**I want** testing utilities and mock helpers,
**so that** I can easily write unit and integration tests for my admin panels.

## Acceptance Criteria

1. `createMockMain()` utility creates a mock MainProvider for testing
2. `createMockList()` utility creates a mock List with test data
3. `createMockHttp()` utility mocks HTTP requests (Get/Post)
4. All utilities have TypeScript support with proper generics
5. Testing guide documentation with examples
6. Utilities are exported from `react-antd-admin-panel/testing`

## Tasks / Subtasks

- [x] **Task 1: Create Testing Module** (AC: 6)
  - [x] Create `packages/core/src/testing/` directory
  - [x] Create `packages/core/src/testing/index.ts`
  - [x] Add `/testing` subpath export to package.json
  - [x] Update vite.config.ts to build testing module

- [x] **Task 2: Implement createMockMain** (AC: 1, 4)
  - [x] Create `packages/core/src/testing/createMockMain.tsx`
  - [x] Accept optional user, store, config overrides
  - [x] Return a wrapper component for testing
  - [x] Include mock navigate function
  - [x] Write tests for the utility

- [x] **Task 3: Implement createMockList** (AC: 2, 4)
  - [x] Create `packages/core/src/testing/createMockList.ts`
  - [x] Accept data array with generic type
  - [x] Return List instance with mocked data
  - [x] Support pagination and filter mocking
  - [x] Write tests for the utility

- [x] **Task 4: Implement createMockHttp** (AC: 3, 4)
  - [x] Create `packages/core/src/testing/createMockHttp.ts`
  - [x] Mock Get requests with configurable responses
  - [x] Mock Post requests with configurable responses
  - [x] Support error simulation
  - [x] Support delay simulation
  - [x] Write tests for the utility

- [x] **Task 5: Testing Guide Documentation** (AC: 5)
  - [x] Create `docs/testing-guide.md`
  - [x] Document how to test components using builders
  - [x] Document how to test hooks
  - [x] Provide 5+ example test patterns
  - [x] Link from main README

## Dev Notes

### API Design

```typescript
// createMockMain usage
import { createMockMain } from 'react-antd-admin-panel/testing';

const { wrapper, mockNavigate, mockHttp } = createMockMain({
  user: { id: '1', name: 'Test User', roles: ['admin'] },
  config: { pathToApi: '/api' }
});

render(<MyComponent />, { wrapper });
```

```typescript
// createMockList usage
import { createMockList } from 'react-antd-admin-panel/testing';

const mockList = createMockList<User>({
  data: [{ id: '1', name: 'John' }],
  loading: false,
  pagination: { page: 1, pageSize: 10, total: 1 }
});
```

```typescript
// createMockHttp usage
import { createMockHttp } from 'react-antd-admin-panel/testing';

const mockHttp = createMockHttp()
  .onGet('/api/users', { data: mockUsers })
  .onPost('/api/users', { data: newUser })
  .onGet('/api/error', { error: new Error('Failed') });
```

### File Structure
```
packages/core/src/testing/
├── index.ts
├── createMockMain.tsx
├── createMockMain.test.tsx
├── createMockList.ts
├── createMockList.test.ts
├── createMockHttp.ts
└── createMockHttp.test.ts
```

## Testing

### Unit Tests
```bash
pnpm --filter react-antd-admin-panel test src/testing
```

### Integration Test
```typescript
// Verify testing utilities work in consumer project
import { createMockMain, createMockHttp } from 'react-antd-admin-panel/testing';

test('can render component with mock main', () => {
  const { wrapper } = createMockMain();
  render(<UserList />, { wrapper });
  expect(screen.getByText('Users')).toBeInTheDocument();
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-11 | 1.0 | Initial story creation | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (Preview)

### Debug Log References
- Fixed template string syntax error in createMockHttp (PowerShell escaping issue)
- Fixed jest.Mock type reference - replaced with custom MockFunction interface
- Fixed User type compatibility in createMockMain

### Completion Notes List
- **createMockHttp**: Fluent API for mocking GET/POST requests with data, errors, delays, status codes
- **createMockMain**: Creates mock MainProvider wrapper with user, store, config options
- **createMockList**: Creates pre-configured List instance with test data
- **MockFunction interface**: Custom mock function type compatible with Jest/Vitest
- **Testing Guide**: 6 example test patterns covering components, navigation, roles, store, lists, HTTP
- **Subpath export**: `/testing` added to package.json exports
- All 3 utilities have full TypeScript generics support
- All tests passing (9 for mockHttp, 10 for mockList, 10 for mockMain)

### File List
| File | Status |
|------|--------|
| packages/core/src/testing/index.ts | Created - module exports |
| packages/core/src/testing/createMockHttp.ts | Created - HTTP mock utility |
| packages/core/src/testing/createMockHttp.test.ts | Created - 9 tests |
| packages/core/src/testing/createMockMain.tsx | Created - Main context mock |
| packages/core/src/testing/createMockMain.test.tsx | Created - 10 tests |
| packages/core/src/testing/createMockList.ts | Created - List mock utility |
| packages/core/src/testing/createMockList.test.ts | Created - 10 tests |
| packages/core/docs/testing-guide.md | Created - comprehensive guide |
| packages/core/package.json | Modified - added /testing export |
| packages/core/vite.config.ts | Modified - added testing entry |
| packages/core/README.md | Modified - added testing section |

---

## QA Results
_To be populated after implementation_
